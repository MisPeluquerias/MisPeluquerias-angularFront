<div class="wrapper">
  <app-navbar-fixed></app-navbar-fixed>
  <div class="content">
    <div class="container-fluid py-5 position-relative">
      <div *ngIf="business" class="row">
        <!-- Título y dirección -->
        <div class="col-12 mb-3">
          <div
            class="d-flex flex-column flex-md-row align-items-md-center justify-content-between mt-3"
          >
            <h1 class="mb-2 h3">
              <b>{{ business.name }}</b>
            </h1>
            <div class="d-flex justify-content-end">
              <!-- Mostrar el botón "Verificado" si el negocio está validado -->
              <ng-container
                *ngIf="business.state === 'Reclamado'; else notVerified"
              >
                <button
                  class="btn btn-lg btn-success rounded-pill btn-custom mt-3"
                  disabled
                >
                  <i class="las la-check-circle"></i> Verificado
                </button>
              </ng-container>

              <!-- Si no está validado, mostrar el botón "Reclamalo ahora" -->
              <ng-template #notVerified>
                <ng-container
                  *ngIf="authService.isAuthenticated(); else loginToClaim"
                >
                  <a
                    class="btn btn-lg btn-danger rounded-pill btn-custom mt-3"
                    [routerLink]="['/reclamation', idSalon]"
                  >
                    <i class="las la-hand-paper"></i> Reclamalo ahora
                  </a>
                </ng-container>
              </ng-template>

              <ng-template #loginToClaim>
                <button
                  class="btn btn-danger rounded-pill btn-custom mt-3"
                  (click)="openLoginModal()"
                >
                  <i class="las la-hand-paper"></i> Reclamalo ahora
                </button>
              </ng-template>
            </div>
          </div>
        </div>

        <!-- Columna de imagen y detalles principales -->
        <div class="col-lg-8 col-md-7 mb-5">
          <div *ngIf="images.length > 0; else noImagesTemplate">
            <!-- Carrusel con imágenes -->
            <div
              id="carouselExampleIndicators"
              class="carousel slide"
              data-bs-ride="carousel"
            >
              <div class="carousel-indicators">
                <button
                  *ngFor="let img of images; let i = index"
                  type="button"
                  [attr.data-bs-target]="'#carouselExampleIndicators'"
                  [attr.data-bs-slide-to]="i"
                  [ngClass]="{ active: i === 0 }"
                  aria-current="true"
                  [attr.aria-label]="'Slide ' + (i + 1)"
                  class="custom-indicator"
                ></button>
              </div>
              <div class="carousel-inner">
                <div
                  *ngFor="let img of images; let i = index"
                  [ngClass]="{ 'carousel-item': true, active: i === 0 }"
                >
                  <img
                    [src]="img.file_url || '../../../assets/img/web/sello.jpg'"
                    class="d-block w-100 fixed-image-size img-fluid"
                    [alt]="img.file_description || 'Imagen del salón'"
                  />
                </div>
              </div>
              <button
                class="carousel-control-prev"
                type="button"
                data-bs-target="#carouselExampleIndicators"
                data-bs-slide="prev"
              >
                <span
                  class="carousel-control-prev-icon"
                  aria-hidden="true"
                ></span>
                <span class="visually-hidden">Anterior</span>
              </button>
              <button
                class="carousel-control-next"
                type="button"
                data-bs-target="#carouselExampleIndicators"
                data-bs-slide="next"
              >
                <span
                  class="carousel-control-next-icon"
                  aria-hidden="true"
                ></span>
                <span class="visually-hidden">Siguiente</span>
              </button>
            </div>
          </div>
          <ng-template #noImagesTemplate>
            <!-- Imagen principal del negocio si no hay imágenes cargadas -->
            <div class="no-images">
              <img
                [src]="business.image"
                class="d-block w-100 fixed-image-size img-fluid"
                alt="Imagen principal del salón"
                (error)="onImageError($event)"
              />
            </div>
          </ng-template>

          <!-- Descripción del negocio -->
          <div class="position-relative">
            <h2 class="mt-5 h4 text-center mb-2 fw-bold">Sobre el salón</h2>
            <div class="position-absolute top-0 end-0">
              <span (click)="shareUrl()" class="me-2"
                ><i
                  class="fa-regular fa-share-from-square"
                  style="
                    font-size: 1.7rem;
                    color: lightslategray;
                    cursor: pointer;
                  "
                ></i
              ></span>
              <i
                (click)="toggleFavorite(business)"
                class="fa-heart me-md-5"
                [ngClass]="{
                  'fa-solid': business.is_favorite,
                  'fa-regular': !business.is_favorite,
                  favorite: business.is_favorite,
                  'not-favorite': !business.is_favorite
                }"
                style="font-size: 1.7rem; cursor: pointer"
              ></i>
            </div>
          </div>

          <div class="mt-4">
            <div *ngFor="let description of descriptionSalon">
              <p *ngIf="description.about_us; else defaultMessage">
                {{ description.about_us }}
              </p>
              <div class="separator-line w-100 mt-4 mb-3"></div>
            </div>
          </div>

          <ng-template #defaultMessage>
            <p class="mt-4">
              {{ business.name }} es un salón ubicado en {{ business.address }}.
              Consulta su horario y pide tu cita hoy mismo en
              {{ business.address }}.
            </p>
          </ng-template>

          <!-- Servicios -->
          <div class="row d-flex mt-5">
            <div class="col">
              <h3 class="mb-4 mt-2 h4 text-center fw-bold">
                Nuestros servicios
              </h3>
              <div
                *ngIf="services.length > 0"
                class="row justify-content-center mt-2"
              >
                <div
                  *ngFor="let service of services"
                  class="col-6 col-md-4 mb-3 d-flex justify-content-center"
                >
                  <button
                    class="btn btn-secondary btn-lgn w-100"
                    data-bs-toggle="modal"
                    data-bs-target="#serviceModal"
                    (click)="openServiceModal(service)"
                  >
                    {{ service.serviceName }}
                  </button>
                </div>
              </div>
              <div class="separator-line w-100 mt-4 mb-3"></div>
            </div>
            <div *ngIf="services.length === 0">
              <p>No hay servicios disponibles.</p>
              <div class="separator-line w-100 mt-5"></div>
            </div>
          </div>

          <div class="row">
            <div class="col-12 col-md-12 mb-4 d-flex flex-column text-center">
              <h2 class="mt-5 h4 mb-2 fw-bold">Marcas del salón</h2>
              <div
                *ngIf="slides && slides.length > 0"
                class="container mt-5 zoom-element"
              >
                <p-carousel
                  [value]="slides"
                  [numVisible]="1"
                  [numScroll]="1"
                  [circular]="true"
                  [autoplayInterval]="3500"
                  [responsiveOptions]="[
                    {
                      breakpoint: '1024px',
                      numVisible: 3,
                      numScroll: 1
                    },
                    {
                      breakpoint: '768px',
                      numVisible: 2,
                      numScroll: 1
                    },
                    {
                      breakpoint: '560px',
                      numVisible: 1,
                      numScroll: 1
                    }
                  ]"
                >
                  <ng-template pTemplate="item" let-slide>
                    <div class="slide">
                      <img
                        [src]="slide.img"
                        class="card-img-top custom-img-height2"
                        [alt]="slide.title"
                        (error)="onImageError($event)"
                      />
                      <!--
                      <h5 class="card-title" style="font-size: 1.2rem">
                        {{ slide.title }}
                      </h5>
                      -->
                    </div>
                  </ng-template>
                </p-carousel>
              </div>
              <div class="separator-line w-100 mt-2"></div>
            </div>
          </div>

          <!-- Opiniones -->
          <div class="row">
            <h2 class="h4 mb-5 mt-3 fw-bold text-center">
              Valoraciones de clientes
            </h2>
          </div>

          <!-- Contenedor de dos columnas -->

          <div
            class="d-flex justify-content-center flex-column mt-5"
            style="margin: 0 auto !important"
          >
            <div class="row">
              <!-- Primera columna -->
              <div class="col-12 col-md-6 mb-4 d-flex flex-column">
                <div class="d-flex mb-3">
                  <!-- Mostrar el promedio de calificación -->
                  <h6
                    class="h4"
                    style="color: #b71622; margin-right: 10px"
                    *ngIf="averageRatings.promedio_qualification !== undefined"
                  >
                    {{
                      averageRatings.promedio_qualification
                        .toFixed(1)
                        .replace(".", ",")
                    }}
                  </h6>
                  <h6
                    *ngIf="averageRatings.promedio_qualification === undefined"
                  >
                    N/A
                  </h6>
                  <!-- Estrellas de calificación -->
                  <span class="d-flex align-items-center">
                    <ng-container *ngFor="let star of stars">
                      <i
                        class="fa"
                        [ngClass]="star"
                        style="
                          color: #b71622;
                          font-size: 1.5rem;
                          margin-right: 3px;
                        "
                      ></i>
                    </ng-container>
                  </span>

                  <span style="margin-left: 15px">
                    {{ averageRatings.total_reviews }} Opiniones
                  </span>
                </div>

                <!-- Barras de progreso para calificaciones -->
                <div class="rating-bars w-100 align-items-left">
                  <div *ngFor="let rating of ratingPorcent">
                    <div class="d-flex justify-content-between">
                      <span>{{ rating.label }}</span>
                      <span>{{ rating.percentage }}%</span>
                    </div>
                    <div class="progress" style="height: 10px">
                      <div
                        class="progress-bar"
                        role="progressbar"
                        [ngStyle]="{ width: rating.percentage + '%' }"
                        [attr.aria-valuenow]="rating.percentage"
                        aria-valuemin="0"
                        aria-valuemax="100"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Segunda columna -->
              <div
                class="col-12 col-md-6 mb-4 d-flex flex-column margin-left-puntuaciones"
                style="max-width: 27%"
              >
                <h5 class="fw-bold">Puntuaciones</h5>
                <!-- Servicio -->
                <div
                  class="rating-input d-flex mb-3 mt-5 justify-content-between"
                >
                  <label class="me-3">Servicio:</label>
                  <div class="circle-input-group">
                    <input
                      type="checkbox"
                      id="averageService1"
                      [checked]="averageRatings.promedio_servicio >= 1"
                      disabled
                    />
                    <label for="averageService1" class="circle-label"></label>

                    <input
                      type="checkbox"
                      id="averageService2"
                      [checked]="averageRatings.promedio_servicio >= 2"
                      disabled
                    />
                    <label for="averageService2" class="circle-label"></label>

                    <input
                      type="checkbox"
                      id="averageService3"
                      [checked]="averageRatings.promedio_servicio >= 3"
                      disabled
                    />
                    <label for="averageService3" class="circle-label"></label>

                    <input
                      type="checkbox"
                      id="averageService4"
                      [checked]="averageRatings.promedio_servicio >= 4"
                      disabled
                    />
                    <label for="averageService4" class="circle-label"></label>

                    <input
                      type="checkbox"
                      id="averageService5"
                      [checked]="averageRatings.promedio_servicio >= 5"
                      disabled
                    />
                    <label for="averageService5" class="circle-label"></label>
                  </div>
                </div>

                <!-- Calidad/Precio -->
                <div class="rating-input d-flex mb-3 justify-content-between">
                  <label class="me-3">Calidad/Precio:</label>
                  <div class="circle-input-group">
                    <input
                      type="checkbox"
                      id="averageQuality1"
                      [checked]="averageRatings.promedio_calidad_precio >= 1"
                      disabled
                    />
                    <label for="averageQuality1" class="circle-label"></label>

                    <input
                      type="checkbox"
                      id="averageQuality2"
                      [checked]="averageRatings.promedio_calidad_precio >= 2"
                      disabled
                    />
                    <label for="averageQuality2" class="circle-label"></label>

                    <input
                      type="checkbox"
                      id="averageQuality3"
                      [checked]="averageRatings.promedio_calidad_precio >= 3"
                      disabled
                    />
                    <label for="averageQuality3" class="circle-label"></label>

                    <input
                      type="checkbox"
                      id="averageQuality4"
                      [checked]="averageRatings.promedio_calidad_precio >= 4"
                      disabled
                    />
                    <label for="averageQuality4" class="circle-label"></label>

                    <input
                      type="checkbox"
                      id="averageQuality5"
                      [checked]="averageRatings.promedio_calidad_precio >= 5"
                      disabled
                    />
                    <label for="averageQuality5" class="circle-label"></label>
                  </div>
                </div>

                <!-- Limpieza -->
                <div class="rating-input d-flex mb-3 justify-content-between">
                  <label class="me-3">Limpieza:</label>
                  <div class="circle-input-group">
                    <input
                      type="checkbox"
                      id="averageCleanliness1"
                      [checked]="averageRatings.promedio_limpieza >= 1"
                      disabled
                    />
                    <label
                      for="averageCleanliness1"
                      class="circle-label"
                    ></label>

                    <input
                      type="checkbox"
                      id="averageCleanliness2"
                      [checked]="averageRatings.promedio_limpieza >= 2"
                      disabled
                    />
                    <label
                      for="averageCleanliness2"
                      class="circle-label"
                    ></label>

                    <input
                      type="checkbox"
                      id="averageCleanliness3"
                      [checked]="averageRatings.promedio_limpieza >= 3"
                      disabled
                    />
                    <label
                      for="averageCleanliness3"
                      class="circle-label"
                    ></label>

                    <input
                      type="checkbox"
                      id="averageCleanliness4"
                      [checked]="averageRatings.promedio_limpieza >= 4"
                      disabled
                    />
                    <label
                      for="averageCleanliness4"
                      class="circle-label"
                    ></label>

                    <input
                      type="checkbox"
                      id="averageCleanliness5"
                      [checked]="averageRatings.promedio_limpieza >= 5"
                      disabled
                    />
                    <label
                      for="averageCleanliness5"
                      class="circle-label"
                    ></label>
                  </div>
                </div>

                <!-- Rapidez -->
                <div class="rating-input d-flex mb-3 justify-content-between">
                  <label class="me-3">Rapidez:</label>
                  <div class="circle-input-group">
                    <input
                      type="checkbox"
                      id="averageSpeed1"
                      [checked]="averageRatings.promedio_puntualidad >= 1"
                      disabled
                    />
                    <label for="averageSpeed1" class="circle-label"></label>

                    <input
                      type="checkbox"
                      id="averageSpeed2"
                      [checked]="averageRatings.promedio_puntualidad >= 2"
                      disabled
                    />
                    <label for="averageSpeed2" class="circle-label"></label>

                    <input
                      type="checkbox"
                      id="averageSpeed3"
                      [checked]="averageRatings.promedio_puntualidad >= 3"
                      disabled
                    />
                    <label for="averageSpeed3" class="circle-label"></label>

                    <input
                      type="checkbox"
                      id="averageSpeed4"
                      [checked]="averageRatings.promedio_puntualidad >= 4"
                      disabled
                    />
                    <label for="averageSpeed4" class="circle-label"></label>

                    <input
                      type="checkbox"
                      id="averageSpeed5"
                      [checked]="averageRatings.promedio_puntualidad >= 5"
                      disabled
                    />
                    <label for="averageSpeed5" class="circle-label"></label>
                  </div>
                </div>
              </div>
            </div>

            <!-- Fila para observaciones (deben estar debajo de las columnas superiores) -->
            <div class="row mt-5 mb-5">
              <div
                class="col-12 col-md-6"
                *ngFor="let observation of observations; let i = index"
              >
                <div class="stars-text text-wrap text-break">
                  <!-- Estrellas -->
                  <div class="d-flex align-items-center mb-2">
                    <span class="d-flex align-items-center">
                      <div>
                        <!-- Recorre las estrellas y muestra los iconos -->
                        <i
                          style="
                            color: #b71622;
                            font-size: 1.5rem;
                            margin-right: 3px;
                          "
                          *ngFor="let starClass of observation.starsObservation"
                          [ngClass]="starClass"
                        ></i>
                      </div>
                    </span>
                    <!-- Fecha -->
                    <span
                      class="ms-3"
                      style="color: #8c8c8c; font-size: 0.8rem"
                    >
                      Opinión escrita el
                      {{ observation.created_at | date : "dd MMMM yyyy" }}
                    </span>
                  </div>

                  <!-- Observación -->
                  <p style="font-size: 1.2rem; font-weight: bold">
                    {{ observation.recommendation }}
                  </p>
                  <p class="mb-5">{{ observation.observacion }}</p>

                  <!-- Botones de editar y eliminar -->
                  <div
                    class="d-flex justify-content-end"
                    *ngIf="
                      observation.id_user === userioId || userType === 'admin'
                    "
                  >
                    <button
                      class="btn btn-secondary btn-sm me-2"
                      data-bs-toggle="modal"
                      data-bs-target="#modificarValoracionesModal"
                      (click)="openEditModal(observation)"
                    >
                      Editar
                    </button>
                    <button
                      class="btn btn-danger btn-sm"
                      style="
                        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1) !important;
                      "
                      data-bs-toggle="modal"
                      data-bs-target="#deleteReviewModal"
                      (click)="setReviewToDelete(observation.id_review)"
                    >
                      Eliminar
                    </button>
                  </div>
                  <div *ngIf="observation.respuesta">
                    <div class="ms-4 mt-4 p-3">
                      <p style="font-weight: bold">
                        {{ business.name }}, respondió a esta opinión
                      </p>
                      <span class="text-muted"
                        >Opinión escrita el
                        {{
                          observation.updated_at | date : "dd MMMM yyyy"
                        }}</span
                      >
                      <p class="mt-3">{{ observation.respuesta }}</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-center align-items-center mt-5">
            <button
              class="btn btn-preview me-2"
              (click)="getObservationReviewSalon(currentPage - 1)"
              [disabled]="currentPage === 1"
            >
              &lt; ANTERIOR
            </button>
            <button
              class="btn-next"
              (click)="getObservationReviewSalon(currentPage + 1)"
              [disabled]="!hasMorePages"
            >
              SIGUIENTE &gt;
            </button>
          </div>

          <ng-container
            *ngIf="isUserAuthenticated === true; else modalToReview"
          >
            <!-- Verificar si el negocio está validado antes de permitir hacer la reseña -->
            <ng-container
              *ngIf="business.state === 'Validado'; else cannotReview"
            >
              <!-- Si el usuario está autenticado y el negocio está validado, abrir el modal de valoraciones -->
              <h2
                style="cursor: pointer"
                class="mt-5 h5 text-center mb-3 fw-bold"
                data-bs-toggle="modal"
                data-bs-target="#valoracionesModal"
              >
                Para dejar valoración pulsa aquí
              </h2>
              <div class="d-flex justify-content-center">
                <i
                  class="fas fa-star"
                  style="color: #b71622; font-size: 1.5rem; margin-right: 3px"
                ></i>
                <i
                  class="fas fa-star"
                  style="color: #b71622; font-size: 1.5rem; margin-right: 3px"
                ></i>
                <i
                  class="fas fa-star"
                  style="color: #b71622; font-size: 1.5rem; margin-right: 3px"
                ></i>
                <i
                  class="fas fa-star"
                  style="color: #b71622; font-size: 1.5rem; margin-right: 3px"
                ></i>
                <i
                  class="fas fa-star"
                  style="color: #b71622; font-size: 1.5rem; margin-right: 3px"
                ></i>
              </div>
            </ng-container>

            <!-- Mensaje si el negocio no está validado -->
            <ng-template #cannotReview>
              <h2 class="mt-5 h5 text-center mb-3 fw-bold">
                No se pueden dejar valoraciones ya que el negocio no está
                validado.
              </h2>
              <div class="d-flex justify-content-center">
                <i
                  class="fas fa-star"
                  style="color: #b71622; font-size: 1.5rem; margin-right: 3px"
                ></i>
                <i
                  class="fas fa-star"
                  style="color: #b71622; font-size: 1.5rem; margin-right: 3px"
                ></i>
                <i
                  class="fas fa-star"
                  style="color: #b71622; font-size: 1.5rem; margin-right: 3px"
                ></i>
                <i
                  class="fas fa-star"
                  style="color: #b71622; font-size: 1.5rem; margin-right: 3px"
                ></i>
                <i
                  class="fas fa-star"
                  style="color: #b71622; font-size: 1.5rem; margin-right: 3px"
                ></i>
              </div>
            </ng-template>
          </ng-container>

          <!-- Si el usuario NO está autenticado, mostrar la opción que abre el modal de login -->
          <ng-template #modalToReview>
            <h2
              style="cursor: pointer"
              class="mt-5 h5 text-center mb-3 fw-bold"
              (click)="openLoginModal()"
            >
              Para dejar valoración pulsa aquí
            </h2>
            <div class="d-flex justify-content-center">
              <i
                class="fas fa-star"
                style="color: #b71622; font-size: 1.5rem; margin-right: 3px"
              ></i>
              <i
                class="fas fa-star"
                style="color: #b71622; font-size: 1.5rem; margin-right: 3px"
              ></i>
              <i
                class="fas fa-star"
                style="color: #b71622; font-size: 1.5rem; margin-right: 3px"
              ></i>
              <i
                class="fas fa-star"
                style="color: #b71622; font-size: 1.5rem; margin-right: 3px"
              ></i>
              <i
                class="fas fa-star"
                style="color: #b71622; font-size: 1.5rem; margin-right: 3px"
              ></i>
            </div>
          </ng-template>
          <div class="separator-line w-100 mt-5 mb-5"></div>

          <!-- Preguntas Frecuentes -->
          <div class="container mt-5">
            <div class="row">
              <!-- Título principal -->
              <div class="col-12 text-center">
                <h2 class="h4 fw-bold">Preguntas y respuestas</h2>
              </div>
            </div>

            <!-- Sección de Preguntas -->
            <div class="row mt-5">
              <div class="col-12">
                <h2 class="fw-bold h6">¿TIENES ALGUNA PREGUNTA?</h2>
                <p class="text-muted">
                  Encuentra respuestas en los detalles de la peluquería, en
                  preguntas y respuestas y en las valoraciones de los clientes.
                </p>
                <div
                  class="d-flex justify-content-between input-group-container"
                >
                  <textarea
                    class="form-control w-50 rounded-3 shadow-sm p-2 text-area-pregunta"
                    placeholder="Si no encuentras la respuesta, haz aquí tu pregunta."
                    maxlength="300"
                    rows="3"
                    [(ngModel)]="questionText"
                    (click)="verifyUser()"
                    (keydown)="verifyUser()"
                  ></textarea>
                  <div class="w-25 me-2 search-container">
                    <input
                      type="text"
                      [(ngModel)]="searchFaqText"
                      class="form-control search-faq-input"
                      placeholder="Buscar..."
                      (input)="onSearch()"
                    />
                  </div>
                </div>
                <!-- El botón solo aparecerá cuando haya texto en el textarea -->
                <button
                  *ngIf="questionText.trim() || authService.isAuthenticated()"
                  class="btn btn-danger mt-2"
                  (click)="addQuestion()"
                >
                  Enviar
                </button>
              </div>
            </div>

            <!-- Listado de Preguntas y Respuestas -->
            <div class="row mt-5">
              <div class="col-12 ms-md-4">
                <ul class="list-unstyled faq-list row ms-md-5">
                  <li
                    *ngFor="let faq of faqs"
                    class="faq-item col-12 col-md-6 my-4"
                  >
                    <div>
                      <h6
                        class="fw-bold h5"
                        style="color: #000; font-weight: bold"
                      >
                        <b>Pregunta</b>
                      </h6>
                      <p>{{ faq.question }}</p>

                      <div
                        class="d-flex justify-content-end"
                        *ngIf="
                          faq.id_user === userioId || this.userType === 'admin'
                        "
                      >
                        <button
                          class="btn btn-secondary btn-sm me-2"
                          data-bs-toggle="modal"
                          data-bs-target="#modificarFaqModal"
                          (click)="openEditFaqModal(faq)"
                        >
                          Editar
                        </button>
                        <button
                          class="btn btn-danger btn-sm"
                          style="
                            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1) !important;
                          "
                          data-bs-toggle="modal"
                          data-bs-target="#deleteFaqModal"
                          (click)="setFaqToDelete(faq.id_faq)"
                        >
                          Eliminar
                        </button>
                      </div>
                    </div>
                    <div *ngIf="faq.answer">
                      <h6 class="fw-bold h5"><b>Respuesta</b></h6>
                      <p>
                        <i class="fa-solid fa-arrow-right"></i> {{ faq.answer }}
                      </p>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-center align-items-center mt-5">
            <button
              class="btn btn-preview me-2"
              [disabled]="currentPage === 1"
              (click)="previousPageFaq()"
            >
              &lt; ANTERIOR
            </button>
            <button
              class="btn-next"
              [disabled]="currentPage === totalPages"
              (click)="nextPageFaq()"
            >
              SIGUIENTE &gt;
            </button>
          </div>
        </div>

        <!-- Columna de información secundaria -->
        <div class="col-lg-4 col-md-5 p-3 rounded">
          <div class="mb-3 position-relative map-container">
            <div
              id="map"
              class="w-100"
              style="
                height: 402px;
                border: 0.1px solid #000;
                border-radius: 12px;
                margin-top: -13px;
              "
            ></div>
            <button class="btn-como-llegar" (click)="openDirections()">
              Cómo llegar
            </button>
          </div>
          <h3 class="h4 mt-2">Información</h3>
          <p class="mb-3">
            <i
              class="fa-solid fa-location-dot me-3"
              style="color: lightslategray"
            ></i
            >{{ business.address }}
          </p>
          <div class="d-flex align-items-center mb-3">
            <span
              ><i class="las la-phone" style="margin-right: 12px"></i>
              {{ business.phone }}</span
            >
            <a
              href="tel:{{ business.phone }}"
              class="btn btn-outline-secondary ms-auto"
              >Llamar</a
            >
          </div>

          <div *ngIf="business?.email && business.email.includes('@')">
            <div class="d-flex align-items-center mb-3">
              <span
                ><i class="las la-envelope" style="margin-right: 12px"></i
                >{{ business.email }}</span
              >
              <a
                href="mailto:{{ business.email }}"
                class="btn btn-outline-secondary ms-auto"
                >Enviar correo</a
              >
            </div>
          </div>

          <div *ngIf="business?.url?.length > 0">
            <div class="d-flex align-items-center mb-3">
              <span
                ><i class="las la-globe" style="margin-right: 12px"></i
                >{{ business.url }}</span
              >
              <a
                href="{{ business.url }}"
                target="_blank"
                class="btn btn-outline-secondary ms-auto"
                >Visitar sitio</a
              >
            </div>
          </div>
          <div class="separator-line w-100 mb-3 w-100"></div>
          <div class="mt-4 fw-bold">
            <div
              *ngIf="
                business.facebook_url ||
                business.instagram_url ||
                business.tiktok_url ||
                business.youtube_url
              "
            ></div>
          </div>

          <div class="mb-5 mt-4 fw-bold d-flex justify-content-between">
            <div *ngIf="business.facebook_url">
              <a class="colorRed" href="{{ business.facebook_url }}"
                ><img src="../../../../assets/img/web/icons8-facebook-48.png"
              /></a>
            </div>

            <div *ngIf="business.instagram_url">
              <a class="colorRed" href="{{ business.instagram_url }}"
                ><img src="../../../../assets/img/web/icons8-instagram-48.png"
              /></a>
            </div>

            <div *ngIf="business.tiktok_url">
              <a class="colorRed" href="{{ business.tiktok_url }}"
                ><img src="../../../../assets/img/web/icons8-tik-tok-48.png"
              /></a>
            </div>

            <div *ngIf="business.youtube_url">
              <a class="colorRed" href="{{ business.youtube_url }}"
                ><img src="../../../../assets/img/web/icons8-youtube-48.png"
              /></a>
            </div>
          </div>
          <div class="horarios mb-5 mt-4">
            <h3 class="h5 mb-3 d-flex align-items-center justify-content-end">
              <span
                [ngClass]="
                  currentStatus === 'Abierto ahora' ? 'dot open' : 'dot closed'
                "
              ></span>
              {{ currentStatus }}
            </h3>
            <h4 class="h4">Horario</h4>
            <ul class="list-unstyled">
              <li>
                <!-- Muestra los horarios formateados directamente -->
                <p class="h6" [innerHTML]="business?.formattedHours"></p>
              </li>
            </ul>
            <ng-container *ngIf="business.state !== 'Reclamado'">
              <p>
                <u
                  ><b><strong>¡Atención!</strong></b></u
                >
                La información que contiene esta página puede no ser correcta
                por que el negocio no está verificado.
              </p>
            </ng-container>
          </div>
        </div>
      </div>
    </div>
  </div>
  <app-footer></app-footer>
</div>

<!--Modal par mostrar subservicios-->
<div
  class="modal fade"
  id="serviceModal"
  tabindex="-1"
  aria-labelledby="serviceModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="serviceModalLabel">
          {{ selectedService?.serviceName }}
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <ul class="list-group">
          <li
            *ngFor="let subservice of selectedService?.subservices"
            class="list-group-item d-flex justify-content-between align-items-center"
          >
            <span>{{ subservice.subservice }}</span>
            <span class="text-success">{{ subservice.time }} min.</span>
            <span class="text-success">
              {{
                +subservice.price !== 0
                  ? subservice.price + " €"
                  : "No definido"
              }}
            </span>
          </li>
        </ul>
        <p
          *ngIf="!selectedService?.subservices?.length"
          class="text-muted mt-2"
        >
          No hay detalles
        </p>
      </div>
    </div>
  </div>
</div>

<!--Modal para valoraciones de clientes-->
<div
  class="modal fade"
  id="valoracionesModal"
  tabindex="-1"
  aria-labelledby="valoracionesModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="valoraciones">
          Tu valoración es importante para nosotros.
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-4 mt-4">
          <img
            src="../../../assets/img/web/sello.jpg"
            width="150"
            alt="logo-mis-peluquerias"
          />
        </div>

        <!-- Servicio -->
        <div
          class="rating-input d-flex align-items-center justify-content-between mb-3 mt-3"
          style="max-width: 55%"
        >
          <label class="me-3">Servicio:</label>
          <div class="circle-input-group">
            <input
              type="checkbox"
              id="service1"
              [(ngModel)]="ratings.service[0]"
              (change)="updateRatings(ratings.service, 0)"
            />
            <label for="service1" class="circle-label"></label>

            <input
              type="checkbox"
              id="service2"
              [(ngModel)]="ratings.service[1]"
              (change)="updateRatings(ratings.service, 1)"
            />
            <label for="service2" class="circle-label"></label>

            <input
              type="checkbox"
              id="service3"
              [(ngModel)]="ratings.service[2]"
              (change)="updateRatings(ratings.service, 2)"
            />
            <label for="service3" class="circle-label"></label>

            <input
              type="checkbox"
              id="service4"
              [(ngModel)]="ratings.service[3]"
              (change)="updateRatings(ratings.service, 3)"
            />
            <label for="service4" class="circle-label"></label>

            <input
              type="checkbox"
              id="service5"
              [(ngModel)]="ratings.service[4]"
              (change)="updateRatings(ratings.service, 4)"
            />
            <label for="service5" class="circle-label"></label>
          </div>
        </div>
        <div class="separator-line w-100 mb-3 w-100"></div>

        <!-- Calidad/Precio -->
        <div
          class="rating-input d-flex align-items-center justify-content-between mb-3"
          style="max-width: 55%"
        >
          <label class="me-3">Calidad/Precio:</label>
          <div class="circle-input-group">
            <input
              type="checkbox"
              id="quality1"
              [(ngModel)]="ratings.quality[0]"
              (change)="updateRatings(ratings.quality, 0)"
            />
            <label for="quality1" class="circle-label"></label>

            <input
              type="checkbox"
              id="quality2"
              [(ngModel)]="ratings.quality[1]"
              (change)="updateRatings(ratings.quality, 1)"
            />
            <label for="quality2" class="circle-label"></label>

            <input
              type="checkbox"
              id="quality3"
              [(ngModel)]="ratings.quality[2]"
              (change)="updateRatings(ratings.quality, 2)"
            />
            <label for="quality3" class="circle-label"></label>

            <input
              type="checkbox"
              id="quality4"
              [(ngModel)]="ratings.quality[3]"
              (change)="updateRatings(ratings.quality, 3)"
            />
            <label for="quality4" class="circle-label"></label>

            <input
              type="checkbox"
              id="quality5"
              [(ngModel)]="ratings.quality[4]"
              (change)="updateRatings(ratings.quality, 4)"
            />
            <label for="quality5" class="circle-label"></label>
          </div>
        </div>

        <div class="separator-line mb-3 w-100"></div>

        <!-- Limpieza -->
        <div
          class="rating-input d-flex align-items-center justify-content-between mb-3"
          style="max-width: 55%"
        >
          <label class="me-3">Limpieza:</label>
          <div class="circle-input-group">
            <input
              type="checkbox"
              id="cleanliness1"
              [(ngModel)]="ratings.cleanliness[0]"
              (change)="updateRatings(ratings.cleanliness, 0)"
            />
            <label for="cleanliness1" class="circle-label"></label>

            <input
              type="checkbox"
              id="cleanliness2"
              [(ngModel)]="ratings.cleanliness[1]"
              (change)="updateRatings(ratings.cleanliness, 1)"
            />
            <label for="cleanliness2" class="circle-label"></label>

            <input
              type="checkbox"
              id="cleanliness3"
              [(ngModel)]="ratings.cleanliness[2]"
              (change)="updateRatings(ratings.cleanliness, 2)"
            />
            <label for="cleanliness3" class="circle-label"></label>

            <input
              type="checkbox"
              id="cleanliness4"
              [(ngModel)]="ratings.cleanliness[3]"
              (change)="updateRatings(ratings.cleanliness, 3)"
            />
            <label for="cleanliness4" class="circle-label"></label>

            <input
              type="checkbox"
              id="cleanliness5"
              [(ngModel)]="ratings.cleanliness[4]"
              (change)="updateRatings(ratings.cleanliness, 4)"
            />
            <label for="cleanliness5" class="circle-label"></label>
          </div>
        </div>

        <div class="separator-line mb-3 w-100"></div>

        <!-- Rapidez -->
        <div
          class="rating-input d-flex align-items-center justify-content-between mb-3"
          style="max-width: 55%"
        >
          <label class="me-3">Rapidez:</label>
          <div class="circle-input-group">
            <input
              type="checkbox"
              id="speed1"
              [(ngModel)]="ratings.speed[0]"
              (change)="updateRatings(ratings.speed, 0)"
            />
            <label for="speed1" class="circle-label"></label>

            <input
              type="checkbox"
              id="speed2"
              [(ngModel)]="ratings.speed[1]"
              (change)="updateRatings(ratings.speed, 1)"
            />
            <label for="speed2" class="circle-label"></label>

            <input
              type="checkbox"
              id="speed3"
              [(ngModel)]="ratings.speed[2]"
              (change)="updateRatings(ratings.speed, 2)"
            />
            <label for="speed3" class="circle-label"></label>

            <input
              type="checkbox"
              id="speed4"
              [(ngModel)]="ratings.speed[3]"
              (change)="updateRatings(ratings.speed, 3)"
            />
            <label for="speed4" class="circle-label"></label>

            <input
              type="checkbox"
              id="speed5"
              [(ngModel)]="ratings.speed[4]"
              (change)="updateRatings(ratings.speed, 4)"
            />
            <label for="speed5" class="circle-label"></label>
          </div>
        </div>
      </div>

      <div class="separator-line mb-3 w-100"></div>
      <!-- Textarea para comentarios o notas adicionales -->
      <div class="form-group mt-4 mb-3">
        <label for="additionalComments" class="form-label ms-3"
          >Comentarios Adicionales:</label
        >
        <textarea
          maxlength="300"
          id="additionalComments"
          class="form-control rounded-3 shadow-sm p-2 mx-auto"
          rows="3"
          [(ngModel)]="additionalComments"
          placeholder="Escribe tus comentarios aquí..."
          style="resize: none; max-width: 95%"
        ></textarea>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancelar
        </button>
        <button
          type="button"
          class="btn btn-danger"
          data-bs-dismiss="modal"
          (click)="addReview()"
        >
          Guardar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal eliminar reseña -->
<div
  class="modal fade"
  id="deleteReviewModal"
  tabindex="-1"
  aria-labelledby="deleteReviewModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="deleteReviewModalLabel">
          Eliminar Reseña
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-3">
          <img
            src="../../../assets/img/web/sello.jpg"
            width="120"
            alt="logo-mis-peluquerias"
          />
        </div>
        <p>¿Esta seguro de eliminar esta reseña?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancelar
        </button>
        <button
          type="button"
          class="btn btn-danger"
          data-bs-dismiss="modal"
          (click)="confirmDeleteReview()"
        >
          Eliminar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal eliminar pregunta -->
<div
  class="modal fade"
  id="deleteFaqModal"
  tabindex="-1"
  aria-labelledby="deleteReviewModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="deleteFaqModalLabel">
          Eliminar Pregunta
        </h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-3">
          <img
            src="../../../assets/img/web/sello.jpg"
            width="120"
            alt="logo-mis-peluquerias"
          />
        </div>
        <p>¿Esta seguro de eliminar esta pregunta?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancelar
        </button>
        <button
          type="button"
          class="btn btn-danger"
          data-bs-dismiss="modal"
          (click)="confirmDeleteFaq()"
        >
          Eliminar
        </button>
      </div>
    </div>
  </div>
</div>

<!--Modal para modificar reseña-->
<div
  class="modal fade"
  id="modificarValoracionesModal"
  tabindex="-1"
  aria-labelledby="modificarValoracionesModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modifcarValoraciones">
          Modificar tu reseña
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-4 mt-4">
          <img
            src="../../../assets/img/web/sello.jpg"
            width="150"
            alt="logo-mis-peluquerias"
          />
        </div>

        <!-- Servicio -->
        <div class="rating-input d-flex align-items-center mb-3 mt-3">
          <label class="me-3">Servicio:</label>
          <div class="circle-input-group">
            <input
              type="checkbox"
              id="service1"
              [(ngModel)]="ratings.service[0]"
              (change)="updateRatings(ratings.service, 0)"
            />
            <label for="service1" class="circle-label"></label>

            <input
              type="checkbox"
              id="service2"
              [(ngModel)]="ratings.service[1]"
              (change)="updateRatings(ratings.service, 1)"
            />
            <label for="service2" class="circle-label"></label>

            <input
              type="checkbox"
              id="service3"
              [(ngModel)]="ratings.service[2]"
              (change)="updateRatings(ratings.service, 2)"
            />
            <label for="service3" class="circle-label"></label>

            <input
              type="checkbox"
              id="service4"
              [(ngModel)]="ratings.service[3]"
              (change)="updateRatings(ratings.service, 3)"
            />
            <label for="service4" class="circle-label"></label>

            <input
              type="checkbox"
              id="service5"
              [(ngModel)]="ratings.service[4]"
              (change)="updateRatings(ratings.service, 4)"
            />
            <label for="service5" class="circle-label"></label>
          </div>
        </div>

        <!-- Calidad/Precio -->
        <div class="rating-input d-flex align-items-center mb-3">
          <label class="me-3">Calidad/Precio:</label>
          <div class="circle-input-group">
            <input
              type="checkbox"
              id="quality1"
              [(ngModel)]="ratings.quality[0]"
              (change)="updateRatings(ratings.quality, 0)"
            />
            <label for="quality1" class="circle-label"></label>

            <input
              type="checkbox"
              id="quality2"
              [(ngModel)]="ratings.quality[1]"
              (change)="updateRatings(ratings.quality, 1)"
            />
            <label for="quality2" class="circle-label"></label>

            <input
              type="checkbox"
              id="quality3"
              [(ngModel)]="ratings.quality[2]"
              (change)="updateRatings(ratings.quality, 2)"
            />
            <label for="quality3" class="circle-label"></label>

            <input
              type="checkbox"
              id="quality4"
              [(ngModel)]="ratings.quality[3]"
              (change)="updateRatings(ratings.quality, 3)"
            />
            <label for="quality4" class="circle-label"></label>

            <input
              type="checkbox"
              id="quality5"
              [(ngModel)]="ratings.quality[4]"
              (change)="updateRatings(ratings.quality, 4)"
            />
            <label for="quality5" class="circle-label"></label>
          </div>
        </div>

        <!-- Limpieza -->
        <div class="rating-input d-flex align-items-center mb-3">
          <label class="me-3">Limpieza:</label>
          <div class="circle-input-group">
            <input
              type="checkbox"
              id="cleanliness1"
              [(ngModel)]="ratings.cleanliness[0]"
              (change)="updateRatings(ratings.cleanliness, 0)"
            />
            <label for="cleanliness1" class="circle-label"></label>

            <input
              type="checkbox"
              id="cleanliness2"
              [(ngModel)]="ratings.cleanliness[1]"
              (change)="updateRatings(ratings.cleanliness, 1)"
            />
            <label for="cleanliness2" class="circle-label"></label>

            <input
              type="checkbox"
              id="cleanliness3"
              [(ngModel)]="ratings.cleanliness[2]"
              (change)="updateRatings(ratings.cleanliness, 2)"
            />
            <label for="cleanliness3" class="circle-label"></label>

            <input
              type="checkbox"
              id="cleanliness4"
              [(ngModel)]="ratings.cleanliness[3]"
              (change)="updateRatings(ratings.cleanliness, 3)"
            />
            <label for="cleanliness4" class="circle-label"></label>

            <input
              type="checkbox"
              id="cleanliness5"
              [(ngModel)]="ratings.cleanliness[4]"
              (change)="updateRatings(ratings.cleanliness, 4)"
            />
            <label for="cleanliness5" class="circle-label"></label>
          </div>
        </div>

        <!-- Rapidez -->
        <div class="rating-input d-flex align-items-center mb-3">
          <label class="me-3">Rapidez:</label>
          <div class="circle-input-group">
            <input
              type="checkbox"
              id="speed1"
              [(ngModel)]="ratings.speed[0]"
              (change)="updateRatings(ratings.speed, 0)"
            />
            <label for="speed1" class="circle-label"></label>

            <input
              type="checkbox"
              id="speed2"
              [(ngModel)]="ratings.speed[1]"
              (change)="updateRatings(ratings.speed, 1)"
            />
            <label for="speed2" class="circle-label"></label>

            <input
              type="checkbox"
              id="speed3"
              [(ngModel)]="ratings.speed[2]"
              (change)="updateRatings(ratings.speed, 2)"
            />
            <label for="speed3" class="circle-label"></label>

            <input
              type="checkbox"
              id="speed4"
              [(ngModel)]="ratings.speed[3]"
              (change)="updateRatings(ratings.speed, 3)"
            />
            <label for="speed4" class="circle-label"></label>

            <input
              type="checkbox"
              id="speed5"
              [(ngModel)]="ratings.speed[4]"
              (change)="updateRatings(ratings.speed, 4)"
            />
            <label for="speed5" class="circle-label"></label>
          </div>
        </div>
      </div>

      <div class="separator-line mb-3 w-100"></div>
      <!-- Textarea para comentarios o notas adicionales -->
      <div class="form-group mt-4 mb-3">
        <label for="additionalComments" class="form-label ms-3"
          >Comentarios Adicionales:</label
        >
        <textarea
          maxlength="300"
          id="additionalComments"
          class="form-control rounded-3 shadow-sm p-2 mx-auto"
          rows="3"
          [(ngModel)]="additionalComments"
          placeholder="Escribe tus comentarios aquí..."
          style="resize: none; max-width: 95%"
        ></textarea>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancelar
        </button>
        <button
          type="button"
          class="btn btn-danger"
          data-bs-dismiss="modal"
          (click)="updateReview()"
        >
          Guardar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal para editar la pregunta y respuesta -->
<div
  class="modal fade"
  id="modificarFaqModal"
  tabindex="-1"
  aria-labelledby="modificarFaqModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modificarFaqModalLabel">
          Modificar Pregunta
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-3">
          <img
            src="../../../assets/img/web/sello.jpg"
            width="120"
            alt="logo-mis-peluquerias"
          />
        </div>
        <div class="mb-3">
          <label for="question" class="form-label">Pregunta</label>
          <textarea
            maxlength="300"
            id="question"
            class="form-control"
            [(ngModel)]="selectedFaq.question"
          ></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancelar
        </button>
        <button
          type="button"
          class="btn btn-danger"
          data-bs-dismiss="modal"
          (click)="updateFaq()"
        >
          Guardar
        </button>
      </div>
    </div>
  </div>
</div>
